<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Redactor Pro</title>
  <style>
    body{font-family:sans-serif;background:#0b1220;color:#e6ebf2}
    canvas{border:1px solid #444;border-radius:8px;background:#000;max-width:100%}
    .btn{padding:8px 12px;border-radius:6px;margin:6px;cursor:pointer}
    .btn.primary{background:#06b6d4;color:#000}
  </style>
</head>
<body>
  <h1>Redactor Pro</h1>
  <input id="file" type="file" accept=".pdf,.png,.jpg,.jpeg"/>
  <button class="btn" id="clear">Clear</button>
  <button class="btn primary" id="download">Download</button>
  <br/><canvas id="c" width="800" height="1100"></canvas>
<script>
const c=document.getElementById('c'); const ctx=c.getContext('2d');
let img=new Image(); let boxes=[]; let dragging=false; let start=null; let fileBlob=null; let isPDF=false; let page=0;
function draw(){ctx.clearRect(0,0,c.width,c.height);if(img.src)ctx.drawImage(img,0,0,c.width,c.height);ctx.strokeStyle='#06b6d4';ctx.lineWidth=2;boxes.forEach(b=>{ctx.strokeRect(b.x,b.y,b.w,b.h);ctx.fillStyle='rgba(6,182,212,0.2)';ctx.fillRect(b.x,b.y,b.w,b.h);});}
c.onmousedown=e=>{if(!img.src)return;dragging=true;const r=c.getBoundingClientRect();start={x:e.clientX-r.left,y:e.clientY-r.top};};
c.onmousemove=e=>{if(!dragging)return;const r=c.getBoundingClientRect();const x=e.clientX-r.left,y=e.clientY-r.top;draw();ctx.setLineDash([6,4]);ctx.strokeStyle='#67e8f9';ctx.strokeRect(start.x,start.y,x-start.x,y-start.y);ctx.setLineDash([]);};
c.onmouseup=e=>{if(!dragging)return;dragging=false;const r=c.getBoundingClientRect();const x=e.clientX-r.left,y=e.clientY-r.top;boxes.push({page,x:Math.min(start.x,x),y:Math.min(start.y,y),w:Math.abs(x-start.x),h:Math.abs(y-start.y)});draw();};
document.getElementById('clear').onclick=()=>{boxes=[];draw();};
document.getElementById('file').onchange=async(e)=>{const f=e.target.files[0];if(!f)return;fileBlob=f;const url=URL.createObjectURL(f);img.src=url;img.onload=()=>{draw();};};
document.getElementById('download').onclick=async()=>{if(!fileBlob){alert('Upload first');return;}const fd=new FormData();fd.append('file',fileBlob);fd.append('rects_json',JSON.stringify(boxes));const endpoint=fileBlob.name.endsWith('.pdf')?'/api/redact_pdf':'/api/redact_image';const res=await fetch(endpoint,{method:'POST',body:fd});const blob=await res.blob();const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=fileBlob.name.endsWith('.pdf')?'redacted.pdf':'redacted.png';a.click();};
</script>
</body>
</html>
