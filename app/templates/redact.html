
<!doctype html>
<html><head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Redact Documents — {{ brand.APP_NAME }}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>:root{--brand: {{ brand.PRIMARY_HEX }};}</style>
</head>
<body class="bg-slate-950 text-slate-100">
<div class="max-w-4xl mx-auto p-6">
  <header class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold">Redact Documents</h1>
    <a href="/" class="px-3 py-1 rounded-lg bg-slate-800 hover:bg-slate-700 text-sm">Back</a>
  </header>

  <form id="redactForm" class="space-y-4" enctype="multipart/form-data">
    <div>
      <label class="block text-sm font-semibold mb-1">File (PDF, DOCX, PNG, JPG)</label>
      <input class="w-full rounded-lg bg-slate-950 border border-slate-800 p-2" type="file" name="file" accept=".pdf,.docx,.png,.jpg,.jpeg" required />
    </div>
    <div class="grid grid-cols-2 gap-4">
      <label class="inline-flex items-center gap-2"><input type="checkbox" name="redact_emails" value="1"/><span>Emails</span></label>
      <label class="inline-flex items-center gap-2"><input type="checkbox" name="redact_phones" value="1"/><span>US Phones</span></label>
      <label class="inline-flex items-center gap-2"><input type="checkbox" name="redact_ssn" value="1"/><span>SSN</span></label>
    </div>
    <div>
      <label class="block text-sm font-semibold mb-1">Custom terms (comma separated)</label>
      <input class="w-full rounded-lg bg-slate-950 border border-slate-800 p-2" type="text" name="custom_terms" placeholder="Acme Inc, John Doe"/>
      <p class="text-xs text-slate-400 mt-1">We replace matches with █████ (PDF/DOCX). For images, we apply a safe default blur to the whole image (box tool can be added later).</p>
    </div>
    <button class="px-4 py-2 rounded-xl text-slate-900" type="submit" style="background: var(--brand)">Redact</button>
  </form>

  <div id="result" class="hidden mt-6 bg-slate-900/50 border border-slate-800 rounded-xl p-4"></div>
</div>

<script>
const form = document.getElementById('redactForm'); const result = document.getElementById('result');
form.addEventListener('submit', async (e)=>{
  e.preventDefault(); result.classList.add('hidden'); result.innerHTML='';
  const fd = new FormData(form);
  const res = await fetch('/api/redact', { method: 'POST', body: fd });
  if(!res.ok){ const t=await res.text(); alert('Redaction failed: ' + t); return; }
  // Attachment streaming; convert to blob and offer download
  const blob = await res.blob();
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'redacted'; a.textContent = 'Download redacted file';
  a.className = 'px-4 py-2 rounded-xl bg-slate-800 hover:bg-slate-700 inline-block';
  result.appendChild(a); result.classList.remove('hidden');
});
</script>
</body></html>
